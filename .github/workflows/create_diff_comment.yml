name: Comentar no PR o diff das specs
on: 
  pull_request:
    branches:
      - "main"
jobs:
  list_diff:
    runs-on: ubuntu-latest
    outputs:
      diff: ${{ steps.job1.outputs.test }}
    steps:
      - uses: actions/checkout@v3
      - name: Realizar o diff entre arquivos
        id: job1
        uses: oasdiff/oasdiff-action/diff@main
        env:
          GITHUB_TOKEN: ${{ secrets.OASDIFF_TOKEN }}
        with:
          base: './swagger-apis/automatic-payments/1.0.0-beta.1.yml'
          revision: './swagger-apis/automatic-payments/1.0.0-beta.2.yml'
  create_diff_comment:
    runs-on: ubuntu-latest
    needs: list_diff
    steps:
     - name: Criação da string de comentário
       run: echo ${{ steps.job1.outputs.diff.* }}
  comment_diff:
    runs-on: ubuntu-latest
    needs: list_diff
    steps:
     - name: Criar o comentário no PR
       uses: mshick/add-pr-comment@v2
       env:
        GITHUB_TOKEN: ${{ secrets.OASDIFF_TOKEN }}       
       with:
         message: |
           ${{ steps.job1.outputs.diff }}

